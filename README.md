## üï∑ Structura Crawler

–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∫—Ä–∞—É–ª–µ—Ä –Ω–∞ –±–∞–∑–µ Scrapy –¥–ª—è –æ–±—Ö–æ–¥–∞ —Å–∞–π—Ç–æ–≤ –∏ —Å–±–æ—Ä–∞ HTML-—Å—Ç—Ä–∞–Ω–∏—Ü –≤ —Ä–∞–º–∫–∞—Ö –æ–¥–Ω–æ–≥–æ –¥–æ–º–µ–Ω–∞. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ –≥–ª—É–±–∏–Ω–µ, –∫–æ–ª–∏—á–µ—Å—Ç–≤—É —Å—Ç—Ä–∞–Ω–∏—Ü, —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π –∏ —ç–∫—Å–ø–æ—Ä—Ç –≤ JSON.

---

### üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
git clone https://github.com/igralkin/StructuraScrapper.git
cd StructuraScrapper
pip install -r requirements.txt
```

---

### ‚ñ∂Ô∏è –ó–∞–ø—É—Å–∫

```bash
python main.py https://structura.app \
  --max-pages 1000 \
  --depth 5 \
  --save-html \
  --output output/data.json
```

üê≥ –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker

–°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞
```bash
docker build -t structura-crawler .
```
–ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
```bash
docker run structura-crawler https://structura.app --max-pages 500 --depth 3 --save-html
```
–ê—Ä–≥—É–º–µ–Ω—Ç—ã –º–æ–∂–Ω–æ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –ø—Ä—è–º–æ –ø–æ—Å–ª–µ –∏–º–µ–Ω–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞.
–ù–∞–ø—Ä–∏–º–µ—Ä:
- –û–±—Ö–æ–¥ –¥–æ 500 —Å—Ç—Ä–∞–Ω–∏—Ü (--max-pages)
- –ì–ª—É–±–∏–Ω–∞ 3 —É—Ä–æ–≤–Ω—è (--depth)
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ HTML-–∫–æ–Ω—Ç–µ–Ω—Ç–∞ –∫–∞–∂–¥–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã (--save-html)

üìÇ –ü—Ä–∏–º–µ—Ä—ã –∫–æ–º–∞–Ω–¥ –∑–∞–ø—É—Å–∫–∞

–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫:
```bash
docker run structura-crawler https://structura.app
```
–ó–∞–ø—É—Å–∫ —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏:
```bash
docker run structura-crawler https://mindbox.ru --max-pages 800 --depth 4 --save-html
```
–ó–∞–ø—É—Å–∫ —Å—Ä–∞–∑—É –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–∞–π—Ç–æ–≤ —Å –Ω–∞—á–∞–ª—å–Ω—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
```bash
docker compose up --build
```
–û—Å—Ç–∞–Ω–æ–≤–∫–∞ 
```bash
docker compose down
```

‚ùó –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

    Docker –≤–µ—Ä—Å–∏–∏ 20.10+

    –î–æ—Å—Ç—É–ø –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –ø—Ä–∏ —Å–±–æ—Ä–∫–µ

‚ú® –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

    –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –≤—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —á–µ—Ä–µ–∑ –∞—Ä–≥—É–º–µ–Ω—Ç—ã –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏

    –ü—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—É—Å–∫–µ –æ—á–∏—â–∞—é—Ç—Å—è —Å—Ç–∞—Ä—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã (output/ –∏ raw/)

    –ü–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–æ –¥–ª—è –¥–µ–ø–ª–æ—è –≤ production


**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `start_url` ‚Äî —Å—Ç–∞—Ä—Ç–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
- `--max-pages` ‚Äî –º–∞–∫—Å–∏–º—É–º —Å—Ç—Ä–∞–Ω–∏—Ü (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 1000)
- `--depth` ‚Äî –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –≥–ª—É–±–∏–Ω–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 5)
- `--save-html` ‚Äî —Å–æ—Ö—Ä–∞–Ω—è—Ç—å HTML –∫–∞–∂–¥–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤ `output/`
- `--output` ‚Äî –ø—É—Ç—å –∫ JSON-—Ñ–∞–π–ª—É —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏

---

### üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
```
crawler/
‚îú‚îÄ‚îÄ cms_detector/              # –ú–æ–¥—É–ª—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è CMS
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ detector.py
‚îÇ   ‚îî‚îÄ‚îÄ signatures.py
‚îÇ
‚îú‚îÄ‚îÄ block_parser/              # –ú–æ–¥—É–ª—å –ø–∞—Ä—Å–∏–Ω–≥–∞ header/footer
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ parser.py              # parse_blocks(html, cms, url)
‚îÇ   ‚îú‚îÄ‚îÄ utils.py               # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —É—Ç–∏–ª–∏—Ç—ã
‚îÇ   ‚îî‚îÄ‚îÄ parsers/
‚îÇ       ‚îú‚îÄ‚îÄ __init__.py
‚îÇ       ‚îú‚îÄ‚îÄ base.py            # –û–±—â–∏–µ –º–µ—Ç–æ–¥—ã –ø–æ–∏—Å–∫–∞
‚îÇ       ‚îú‚îÄ‚îÄ wordpress.py
‚îÇ       ‚îú‚îÄ‚îÄ tilda.py
‚îÇ       ‚îú‚îÄ‚îÄ bitrix.py
‚îÇ       ‚îú‚îÄ‚îÄ html5.py
‚îÇ       ‚îî‚îÄ‚îÄ drupal.py
‚îÇ
‚îú‚îÄ‚îÄ tests/                     # –Æ–Ω–∏—Ç-—Ç–µ—Å—Ç—ã –ø–∞—Ä—Å–µ—Ä–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ test_wordpress.py
‚îÇ   ‚îú‚îÄ‚îÄ test_tilda.py
‚îÇ   ‚îú‚îÄ‚îÄ test_bitrix.py
‚îÇ   ‚îú‚îÄ‚îÄ test_drupal.py
‚îÇ   ‚îî‚îÄ‚îÄ test_html5.py
‚îÇ
‚îú‚îÄ‚îÄ main.py
‚îú‚îÄ‚îÄ spiders/
‚îÇ   ‚îî‚îÄ‚îÄ base_spider.py
‚îú‚îÄ‚îÄ settings.py
‚îú‚îÄ‚îÄ requirements.txt
‚îú‚îÄ‚îÄ Dockerfile
‚îú‚îÄ‚îÄ .gitignore
‚îî‚îÄ‚îÄ output/
```
---

### üîå –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è CMS-–¥–µ—Ç–µ–∫—Ç–æ—Ä–∞

–ú–æ–¥—É–ª—å `cms_detector` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç CMS –ø–æ HTML-–∫–æ–¥—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã. 

–û–Ω —É–∂–µ –≤—Å—Ç—Ä–æ–µ–Ω –≤ `base_spider.py` –∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç CMS **—Ç–æ–ª—å–∫–æ –Ω–∞ –ø–µ—Ä–≤—ã—Ö 5 HTML-—Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö** –¥–ª—è –ø–æ–≤—ã—à–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏.

**–§–æ—Ä–º–∞—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –≤ `output/data.json`:**
```json
{
  "url": "https://example.com",
  "depth": 0,
  "cms": "wordpress"
}
```

–í—ã –º–æ–∂–µ—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü, –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–≤ –ø–∞—Ä–∞–º–µ—Ç—Ä `self.pages_crawled <= 5` –≤ `BaseSpider.parse()`.

---

### üê≥ –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker

```bash
docker build -t structura-crawler .
docker run structura-crawler https://structura.app --max-pages 200 --depth 3 --save-html
```

---

### ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ (settings.py)
- `SKIP_EXTENSIONS` ‚Äî —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ —Å–∫–∞—á–∏–≤–∞—é—Ç—Å—è (–Ω–∞–ø—Ä–∏–º–µ—Ä .pdf, .svg)
- `DEPTH_LIMIT`, `CLOSESPIDER_PAGECOUNT` ‚Äî –ª–∏–º–∏—Ç—ã –∫—Ä–∞—É–ª–µ—Ä–∞

---

### ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞
- –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ —Å—Å—ã–ª–∫–∏ (–≤ —Ä–∞–º–∫–∞—Ö –æ–¥–Ω–æ–≥–æ –¥–æ–º–µ–Ω–∞)
- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –æ–±—Ö–æ–¥
- –£–≤–∞–∂–∞–µ—Ç robots.txt
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Å—Å—ã–ª–æ–∫ –ø–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è–º
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ –±–æ–ª—å—à–∏–µ —Å–∞–π—Ç—ã (1000+ —Å—Ç—Ä–∞–Ω–∏—Ü)

---

### üìå –ü—Ä–∏–º–µ—Ä—ã —Å–∞–π—Ç–æ–≤ –¥–ª—è —Ç–µ—Å—Ç–∞
- https://botcreators.ru
- https://structura.app
- https://automatisation.art
- https://mindbox.ru
- https://skillfactory.ru

### üß± –ü–∞—Ä—Å–∏–Ω–≥ –±–ª–æ–∫–æ–≤ (Header/Footer Parser)

–ú–æ–¥—É–ª—å `block_parser` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–∑–≤–ª–µ–∫–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ –±–ª–æ–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã (`<header>` –∏ `<footer>`) –Ω–∞ –æ—Å–Ω–æ–≤–µ HTML-–∫–æ–¥–∞ –∏ —Ç–∏–ø–∞ CMS.

#### üì• –í—Ö–æ–¥–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
- HTML —Å—Ç—Ä–∞–Ω–∏—Ü—ã (`str`)
- –ù–∞–∑–≤–∞–Ω–∏–µ CMS (`str`): `wordpress`, `tilda`, `bitrix`, `html5`, `drupal`
- (–æ–ø—Ü.) URL —Å—Ç—Ä–∞–Ω–∏—Ü—ã ‚Äî –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

#### üì§ –§–æ—Ä–º–∞—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞:
```json
{
  "cms": "wordpress",
  "blocks": {
    "header": {
      "found": true,
      "content": "<header>...</header>",
      "strategy": "css:header"
    },
    "footer": {
      "found": true,
      "content": "<footer>...</footer>",
      "strategy": "id:colophon"
    }
  }
}
```

#### üîç –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ CMS:
- **WordPress** ‚Äî `site-header`, `masthead`, `site-footer`, —Ç–µ–≥–∏ `<header>` / `<footer>`
- **Tilda** ‚Äî `t*-rec` —Å `t*-header`, `t*-footer` (ID: `rec123`)
- **Bitrix** ‚Äî –∫–ª–∞—Å—Å—ã `bx-layout`, `adm-footer`, `bx-header`
- **HTML5** ‚Äî —Ç–µ–≥–∏ `<header>`, `<footer>`
- **Drupal** ‚Äî –∫–ª–∞—Å—Å—ã `region-header`, `region-footer`, `block-system-branding`, ID `branding`, `footer`

#### üß™ –¢–µ—Å—Ç—ã:
–ú–æ–¥—É–ª—å –ø–æ–∫—Ä—ã—Ç —é–Ω–∏—Ç-—Ç–µ—Å—Ç–∞–º–∏ (`tests/`):
```bash
python -m unittest discover -s tests
```
#### üîå –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –∫—Ä–∞—É–ª–µ—Ä:
–ú–æ–¥—É–ª—å –≤—Å—Ç—Ä–æ–µ–Ω –≤ `base_spider.py` –∏ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è CMS:
```python
from block_parser.parser import parse_blocks
blocks = parse_blocks(html, cms, url=response.url)
item['blocks'] = blocks
```

#### üìù –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:
–õ–æ–≥–∏—Ä—É—é—Ç—Å—è –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –±–ª–æ–∫–∏, —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∏ URL:
```
[https://example.com] HEADER ‚Äî found: True, strategy: css:header
```
